#硬件 #MPU6050 #STM32 #欧拉角

>欧拉角无非就 `yaw` `roll` `pitch` 三个参数。
>
>解算欧拉角有两种方式：
>	1. 加速度（Accelerometer）计姿态测量
>	2. 陀螺仪（Gyroscope）姿态测量
>
>两种方式各有优劣，但是想要准确解算欧拉角，需要综合两种测量方案以减少误差。
>
>[[MPU6050]]具有加速度计、陀螺仪与温度传感器。
>
>下面将分别简述两种测量方式的原理及其在MPU6050上的实现。

> [!quote] 欧拉角
>*以运动物体建立坐标系，通过绕轴旋转来表示运动物体当前的姿态*
>
>![[Pasted image 20251107220508.png]]

## 两种基本方法

### 加速度（Accelerometer）计姿态测量

#### 测量原理

我们已知重力加速度垂直于水平地面。因此可以通过测量重力加速度在三个轴的分量便可以测得欧拉角。

![[Pasted image 20251107222100.png]]

> [!warning]
>然而，待测物体常如飞机一样大体处于水平方向，y轴向分重力加速度几乎为0，此时`yaw`角难以测量。
>
>因此，当使用加速度（Accelerometer）计姿态测量欧拉角时，我们常常仅测量`roll`与`pitch`

>[!example]
>以`pitch`的计算为例，则下图中`pitch`的计算式为：
>```c
>pitch = -atan2(ax, az);
>```

>此处`atan2()`为`math.h`库中的函数。相较于`atan()`，它可以处理象限的问题。

`roll`的计算方式同理。

![[Pasted image 20251107222652.png]]

#### 优点

由于是直接利用加速度计算，因此可以直接计算得出欧拉角。

每次测量时不依赖上次数据，因此**不会出现误差累积**。

#### 缺点

理想情况下，待测物体的加速度应该是有且仅有重力加速度。然而，由于不可避免的外部震动以及实际情况下可能的变速运动，会导致测的结果会存在大量噪声。

![[Pasted image 20251108124410.png]]

>因此，**仅仅使用加速度计测量欧拉角是远远不够的。**

### 陀螺仪（Gyroscope）姿态测量

> [!info]
>[[MPU6050]]的陀螺仪可以测得三轴角速度：`gx` `gy` `gz`，单位为`deg/s`。
>
>如输出`gx = 720`则代表每秒钟绕 x轴 旋转两周。

#### 测量原理

原始数据为角速度，目标数据为角度，因此可以烤炉积分求解。

由于[[MPU6050]]数据更新依赖于时钟，因此可以以一个`tick`的时间作为`delta_t`，由此对角速度进行积分。

>[!example]
>以`pitch`为例，其在时间`t`的计算公式为：
>```c
>pitch(t) = pitch(t - delta_t) + gy * delta_t;
>^~~~~~~~   ^~~~~~~~~~~~~~~~~~   ^~   ^~~~~~~
>新角度      上次角度             角速度 时间
>```

>至于角动量守恒等下再说，现在看不懂。

#### 优点

由于是基于[[角动量守恒]]，因此短期测量准确、无干扰，不会受到外部震动的影响。

#### 缺点

由公式可知，下一次的测量结果依赖于上一次的结果。因此，误差会慢慢累积，即漂移现象。

![[Pasted image 20251108171737.png]]

### 两种方式的比较

>[!summary]
>| | 加速度计姿态测量 | 陀螺仪姿态测量 |
>|---|---|---|
>| 输出结果 | 三轴加速度 | 三轴角速度 |
>| 短期 | 测量结果多毛刺 | 测量结果准确 |
>| 长期 | 无误差积累 | 有明显误差积累 |
>
>>由此可见：加速度计姿态测量和陀螺仪姿态测量为一对互补的关系。

>因此，想要准确求得欧拉角，需要使用**融合算法**。
## 融合算法

### 互补滤波算法

#### 公式

```
pitch = α * pitch_g + (1 - α) * pitch_a
```

>实际上就是一个加权平均数而已。

#### 权重值α的取值问题

>[!attention]
>只有当权重值α取值合理时互补结果才可靠。

关于α的取值，有以下公式：

```
α = τ / (τ + Δt)
```

公式中Δt为传感器刷新间隔，τ在下图中代表两值相拟合的时间，**一般取0.1s**。

![[Pasted image 20251108175721.png]]

### 四元数法

>看不懂，也不深究。

### 卡尔曼滤波法

>看不懂，也不深究。